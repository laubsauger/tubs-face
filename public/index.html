<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TUBS BOT</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

  <div id="grid">

    <!-- TOP-LEFT: System Vitals -->
    <div class="panel stagger-1 collapsed" id="panel-tl">
      <div class="panel-title">
        System Vitals
        <span class="dot red header-dot" id="header-conn-dot"></span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Connection</span>
        <span class="stat-value" id="stat-conn"><span class="dot red" id="conn-dot"></span>Offline</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Uptime</span>
        <span class="stat-value" id="stat-uptime">00:00:00</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Awake Since</span>
        <span class="stat-value" id="stat-awake">—</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Model</span>
        <span class="stat-value" id="stat-model">—</span>
      </div>
    </div>

    <!-- CENTER: Face -->
    <div id="center">
      <div id="face">
        <div class="eye left">
          <div class="pupil"></div>
          <div class="eyelid top"></div>
          <div class="eyelid bottom"></div>
        </div>
        <div class="eye right">
          <div class="pupil"></div>
          <div class="eyelid top"></div>
          <div class="eyelid bottom"></div>
        </div>
        <div id="mouth"></div>
        <span class="zzz">z</span>
        <span class="zzz">z</span>
        <span class="zzz">z</span>
      </div>
      <div id="loading-bar">
        <div class="fill"></div>
      </div>
      <div id="waveform-container"></div>
      <div id="ptt-indicator">Hold Space to Talk</div>
      <div id="speech-bubble"></div>
    </div>

    <!-- TOP-RIGHT: Input Status -->
    <div class="panel stagger-2 collapsed" id="panel-tr">
      <div class="panel-title">Input Status</div>
      <div class="stat-row">
        <span class="stat-label">Mic Active</span>
        <span class="stat-value" id="stat-mic">Off</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Volume</span>
        <span class="stat-value">
          <div class="volume-bar-container">
            <div class="volume-bar-fill" id="stat-vol"></div>
          </div>
        </span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Input Source</span>
        <span class="stat-value" id="stat-input-src">—</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Last Heard</span>
        <span class="stat-value" id="stat-last-heard">—</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">STT Confidence</span>
        <span class="stat-value" id="stat-stt">—</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">State</span>
        <span class="stat-value" id="stat-listen-state">Idle</span>
      </div>
      <div class="stat-row" style="margin-top: 5px; padding-top: 5px; border-top: 1px solid rgba(60,70,110,0.2);">
        <span class="stat-label">Always On</span>
        <label class="toggle-switch">
          <input type="checkbox" id="vad-toggle">
          <span class="slider"></span>
        </label>
      </div>
      <div class="stat-row">
        <span class="stat-label">Camera</span>
        <label class="toggle-switch">
          <input type="checkbox" id="camera-toggle">
          <span class="slider"></span>
        </label>
      </div>
      <div class="stat-row" id="detect-delay-row" style="display:none;">
        <span class="stat-label">Detect <span id="detect-delay-val">auto</span></span>
        <input type="range" id="detect-delay" min="0" max="5000" step="100" value="0" class="mini-range">
      </div>
      <div class="stat-row" style="margin-top: 5px; padding-top: 5px; border-top: 1px solid rgba(60,70,110,0.2);">
        <span class="stat-label">Sleep <span id="sleep-timeout-val">10s</span></span>
        <input type="range" id="sleep-timeout" min="5" max="600" step="5" value="10" class="mini-range">
      </div>
    </div>

    <!-- BOTTOM-LEFT: Chat Log -->
    <div class="panel stagger-3 collapsed" id="panel-bl">
      <div class="panel-title">Chat Log <span style="margin-left:auto;font-weight:400;color:var(--text-dim)"
          id="turn-counter">0 turns</span></div>
      <div id="chat-log"></div>
      <div id="panel-bl-resize"></div>
    </div>

    <!-- BOTTOM-RIGHT: Bot Stats -->
    <div class="panel stagger-4 collapsed" id="panel-br">
      <div class="panel-title">Bot Stats</div>
      <div class="stat-row">
        <span class="stat-label">Response Time</span>
        <span class="stat-value" id="stat-resp-time">— ms</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Tokens In</span>
        <span class="stat-value" id="stat-tok-in">0</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Tokens Out</span>
        <span class="stat-value" id="stat-tok-out">0</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Queue Depth</span>
        <span class="stat-value" id="stat-queue">0</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Expression</span>
        <span class="stat-value" id="stat-expression">IDLE</span>
      </div>
      <div class="stat-row">
        <span class="stat-label">Session Cost</span>
        <span class="stat-value" id="stat-cost">$0.00</span>
      </div>
    </div>

    <!-- Camera PIP -->
    <div id="camera-pip" class="hidden">
      <div id="camera-pip-header">Camera</div>
      <video id="camera-feed" autoplay playsinline muted></video>
      <canvas id="camera-overlay"></canvas>
      <div id="camera-status"></div>
      <div id="presence-badge"></div>
    </div>

    <!-- Face Detection Debug Panel -->
    <div id="face-debug" class="hidden">
      <div id="face-debug-header">Face Debug <span id="face-debug-close">✕</span></div>
      <div id="face-debug-body">
        <div id="face-debug-frame">
          <canvas id="face-debug-canvas"></canvas>
        </div>
        <div id="face-debug-info">
          <div class="debug-row"><span class="debug-label">Interval</span><span id="dbg-interval">—</span></div>
          <div class="debug-row"><span class="debug-label">Inference</span><span id="dbg-inference">—</span></div>
          <div class="debug-row"><span class="debug-label">Faces</span><span id="dbg-faces">0</span></div>
          <div class="debug-row"><span class="debug-label">Library</span><span id="dbg-library">0</span></div>
        </div>
        <div id="face-debug-detections"></div>
      </div>
    </div>

  </div>

  <!-- CDN deps (regular scripts, set globals) -->
  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.14.0/dist/ort.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@ricky0123/vad-web@0.0.7/dist/bundle.min.js"></script>

  <!-- Single module entry point -->
  <script type="module" src="js/main.js"></script>
</body>

</html>
